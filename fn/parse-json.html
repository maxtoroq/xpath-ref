<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" itemscope="itemscope" itemtype="http://schema.org/WebPage">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta name="viewport" content="width=device-width,initial-scale=1.0" />
      <title>fn:parse-json</title>
      <link rel="stylesheet" href="../bootstrap/dist/css/bootstrap.min.css" />
      <link rel="stylesheet" href="../css/site.css" />
      <link rel="shortcut icon" href="../favicon.ico" />
   </head>
   <body>
      <header role="navigation">
         <nav class="container">
            <div class="col-md-9 breadcrumb-col">
               <ol class="breadcrumb" itemprop="breadcrumb">
                  <li><a href="../">XPath Reference</a></li>
                  <li class="active">fn:parse-json</li>
               </ol>
            </div>
            <div class="col-md-3 search-col">
               <form method="get" action="https://cse.google.com/cse"><input type="hidden" name="cx" value="012329136009221431645:sv1eakamyny" /><div class="input-group"><input type="search" name="q" class="form-control" placeholder="Search" /><span class="input-group-btn"><button class="btn btn-default" type="button"><i class="glyphicon glyphicon-search"></i></button></span></div>
               </form>
            </div>
         </nav>
      </header>
      <article class="container" itemscope="itemscope" itemtype="http://schema.org/WebPageElement" itemprop="mainContentOfPage">
         <header>
            <h1 class="page-header">fn:parse-json</h1>
         </header>
         <p>Parses a string supplied in the form of a JSON text, returning the results typically
            in the form
            of a map or array.
         </p>
         <section>
            <header>
               <h2>Signatures</h2>
            </header><pre><code class="signature"><span class="function">fn:parse-json</span><span class="parenthesis">(</span><span class="variable">$json-text</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="type-name">xs:string</span><span class="quantifier">?</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="type">item</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="quantifier">?</span></code></pre><pre><code class="signature"><span class="function">fn:parse-json</span><span class="parenthesis">(</span><span class="whitespace">&#xD;
    </span><span class="variable">$json-text</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="type-name">xs:string</span><span class="quantifier">?</span><span class="op">,</span><span class="whitespace"> &#xD;
    </span><span class="variable">$options</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="node-type">map</span><span class="parenthesis">(</span><span class="quantifier">*</span><span class="parenthesis">)</span><span class="whitespace">&#xD;
</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="type">item</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="quantifier">?</span></code></pre></section>
         <section>
            <header>
               <h2>Properties</h2>
            </header>
            <p>This function is <a href="https://www.w3.org/TR/xpath-functions-31/#dt-deterministic">deterministic</a>, <a href="https://www.w3.org/TR/xpath-functions-31/#dt-context-independent">context-independent</a>,  and <a href="https://www.w3.org/TR/xpath-functions-31/#dt-focus-independent">focus-independent</a>. 
            </p>
         </section>
         <section>
            <header>
               <h2>Rules</h2>
            </header>
            <p>The effect of the one-argument form of this function is the same as calling the
               two-argument form with an empty map as the value of the <code>$options</code>
               argument.
            </p>
            <p>The first argument is a JSON text as defined in <a href="http://www.rfc-editor.org/rfc/rfc7159.txt">[RFC 7159]</a>, in the form of a string. The function
               parses this string to return an XDM value.
            </p>
            <p>If the value of <code>$json-text</code> is the empty sequence, the function returns the empty sequence.
            </p>
            <blockquote>
               <p>The result will also be an empty sequence if <code>$json-text</code> is the string <code>"null"</code>.
               </p>
            </blockquote>
            <p>The <code>$options</code> argument can be used to control the way in which the parsing
               takes place. The <a href="https://www.w3.org/TR/xpath-functions-31/#option-parameter-conventions">option parameter conventions</a> apply.
            </p>
            <p>The entries that may appear in the <code>$options</code> map are as follows:
            </p>KeyValueMeaning<code>liberal</code>Determines whether deviations from the syntax of RFC7159 are permitted.
            <ul>
               <li>
                  <p>Type: <code>xs:boolean</code></p>
               </li>
               <li>
                  <p>Default: <code>false</code></p>
               </li>
            </ul><code>false</code>
            The input <b>must</b> consist of an optional byte order mark (which is ignored) followed by a string
            that conforms to the grammar of <code>JSON-text</code> in <a href="http://www.rfc-editor.org/rfc/rfc7159.txt">[RFC 7159]</a>. An error <b>must</b> be raised
            [<a href="https://www.w3.org/TR/xpath-functions-31/#ERRFOJS0001">ERRFOJS0001</a>] if the input does not conform to the grammar.
            <code>true</code>
            The input <b>may</b> contain deviations from the grammar of <a href="http://www.rfc-editor.org/rfc/rfc7159.txt">[RFC 7159]</a>,
            which are handled in an <a href="https://www.w3.org/TR/xpath-functions-31/#implementation-defined">implementation-defined</a> way. (Note: some popular
            extensions include allowing quotes on keys to be omitted, allowing a comma
            to appear after the last item in an array, allowing leading zeroes in numbers, and
            allowing control characters such as
            tab and newline to be present in unescaped form.) Since the extensions accepted
            are implementation-defined, an error <b>may</b> be raised
            [<a href="https://www.w3.org/TR/xpath-functions-31/#ERRFOJS0001">ERRFOJS0001</a>] if the input does not conform to the grammar.
            <code>duplicates</code>Determines the policy for handling duplicate keys in a JSON object.
            To determine whether keys are duplicates, they are compared using the Unicode codepoint
            collation, after expanding escape
            sequences, unless the <code>escape</code> option is set to <code>true</code>, in which
            case keys are compared in escaped form. 
            
            <ul>
               <li>
                  <p>Type: <code>xs:string</code></p>
               </li>
               <li>
                  <p>Default: <code>use-first</code></p>
               </li>
            </ul><code>reject</code>
            An error is raised [<a href="https://www.w3.org/TR/xpath-functions-31/#ERRFOJS0003">ERRFOJS0003</a>] if duplicate keys are encountered.
            <code>use-first</code>
            If duplicate keys are present in a JSON object, all but the first of a set of duplicates
            are ignored.
            <code>use-last</code>
            If duplicate keys are present in a JSON object, all but the last of a set of duplicates
            are ignored.
            <code>escape</code>Determines whether special characters are represented in the XDM output in backslash-escaped
            form.
            <ul>
               <li>
                  <p>Type: <code>xs:boolean</code></p>
               </li>
               <li>
                  <p>Default: <code>true</code></p>
               </li>
            </ul><code>false</code>
            All characters in the input that are valid
            in the version of XML supported by the implementation, whether or not they are represented
            
            in the input by means of an escape sequence, are represented as unescaped characters
            in the result. Any
            characters or codepoints that are not valid XML characters 
            (for example, unpaired surrogates) are passed to the <code>fallback</code> function
            as described below; in the absence of a fallback function, they are replaced by
            the Unicode <code>REPLACEMENT CHARACTER</code> (<code>xFFFD</code>).
            <code>true</code>
            JSON escape sequences are used in the result to represent special characters in the
            JSON input, as defined below, 
            whether or not they were represented using JSON escape sequences in the input.
            The characters that are considered "special" for this purpose are:
            
            <ul>
               <li>
                  <p>all codepoints in the range <code>x00</code> to <code>x1F</code> 
                     or <code>x7F</code> to <code>x9F</code>;
                  </p>
               </li>
               <li>
                  <p>all codepoints that do not represent characters that are valid in the version of XML
                     supported by the processor,
                     including codepoints representing unpaired surrogates;
                  </p>
               </li>
               <li>
                  <p>the backslash character itself (<code>x5C</code>).
                  </p>
               </li>
            </ul>
            
            Such characters are represented using a two-character
            escape sequence where available (for example, <code>\t</code>), or a six-character escape sequence otherwise
            (for example <code>\uDEAD</code>). Characters other than these are not escaped in the result, even if they
            were escaped in the input.
            <code>fallback</code>
            Provides a function which is called when the input contains an escape sequence 
            that represents a character that is not valid in the version of XML
            supported by the implementation. 
            
            It is an error to supply the <code>fallback</code> option if the <code>escape</code> option is present
            with the value <code>true</code>.
            
            <ul>
               <li>
                  <p>Type: <code>function(xs:string) as xs:string</code></p>
               </li>
               <li>
                  <p>Default: <code>The default is effectively the function function($s){"&amp;#xFFFD;"}: that is,
                        a function that replaces the escape sequence with the Unicode REPLACEMENT CHARACTER.</code></p>
               </li>
            </ul><code>User-supplied function</code>
            The function is called when the JSON input contains a special character (as defined
            under 
            the <code>escape</code> option) that is valid according to the JSON 
            grammar, whether the special character is represented in the input directly or as
            an escape sequence. 
            The function is called once for any surrogate
            that is not properly paired with another surrogate. The string supplied as the argument
            will always be a two- or six- character escape
            sequence, starting with a backslash, that conforms to the rules in the JSON grammar
            (as extended by the
            implementation if <code>liberal:true()</code> is specified): for example
            <code>\b</code> or <code>\uFFFF</code> or <code>\uDEAD</code>. The function is not
            called for an escape sequence that is invalid against the grammar (for example <code>\x0A</code>). The function returns a string
            which is inserted into the result in place of the invalid character. The
            function also has the option of raising a dynamic error by calling <code>fn:error</code>.
            
            <p>The various structures that can occur in JSON are transformed recursively to XDM values
               as follows:
            </p>
            <ol>
               <li>
                  <p>A JSON object is converted to a map. 
                     The entries in the map correspond to the key/value
                     pairs in the JSON object. The key is always of type <code>xs:string</code>; the
                     associated value may be of any type, and is the result of converting the JSON
                     value by recursive application of these rules. For example, the JSON text
                     <code>{"x":2, "y":5}</code> is transformed to the value <code>map{"x":2,
                        "y":5}</code>.
                  </p>
                  <p>If duplicate keys are encountered in a JSON object, they are handled
                     as determined by the <code>duplicates</code> option defined above.
                  </p>
               </li>
               <li>
                  <p>A JSON array is transformed to an array whose members are the result of converting
                     the corresponding member of the array by recursive application of these rules. For
                     example, the JSON text <code>["a", "b", null]</code> is transformed to the value
                     <code>["a", "b", ()]</code>.
                  </p>
               </li>
               <li>
                  <p>A JSON string is converted to an <code>xs:string</code> value. 
                     The handling of special characters depends on the
                     <code>escape</code> and <code>fallback</code> options, as described in the table above.
                  </p>
               </li>
               <li>
                  <p>A JSON number is converted to an <code>xs:double</code> value using
                     the rules for casting from <code>xs:string</code> to <code>xs:double</code>.
                  </p>
               </li>
               <li>
                  <p>The JSON boolean values <code>true</code> and <code>false</code> are
                     converted to the corresponding <code>xs:boolean</code> values.
                  </p>
               </li>
               <li>
                  <p>The JSON value null is converted to the empty sequence.</p>
               </li>
            </ol>
         </section>
         <section>
            <header>
               <h2>Error Conditions</h2>
            </header>
            <p>A dynamic error [<a href="https://www.w3.org/TR/xpath-functions-31/#ERRFOJS0001">ERRFOJS0001</a>] occurs if the value of
               <code>$input</code> does not conform to the JSON grammar, unless the option
               <code>"liberal":true()</code> is present and the processor chooses to accept the deviation.
            </p>
            <p>A dynamic error [<a href="https://www.w3.org/TR/xpath-functions-31/#ERRFOJS0003">ERRFOJS0003</a>] occurs if the option
               <code>"duplicates":"reject"</code> is present and the value of
               <code>$input</code> contains a JSON object with duplicate keys.
            </p>
            <p>A dynamic error [<a href="https://www.w3.org/TR/xpath-functions-31/#ERRFOJS0005">ERRFOJS0005</a>] occurs if the <code>$options</code>
               map contains an entry whose key is defined in this specification and whose value is
               not valid for that key,
               or if it contains an entry with the key <code>fallback</code> when the option <code>"escape":true()</code>
               is also present.
            </p>
         </section>
         <section>
            <header>
               <h2>Notes</h2>
            </header>
            <p>The result of the function will be an instance of one of the following types. An
               <code>instance of</code> test (or in XQuery, <code>typeswitch</code>) can be used to
               distinguish them:
            </p>
            <ul>
               <li>
                  <p><code>map(xs:string, item()?)</code> for a JSON object
                  </p>
               </li>
               <li>
                  <p><code>array(item()?)</code> for a JSON array
                  </p>
               </li>
               <li>
                  <p><code>xs:string</code> for a JSON string
                  </p>
               </li>
               <li>
                  <p><code>xs:double</code> for a JSON number
                  </p>
               </li>
               <li>
                  <p><code>xs:boolean</code> for a JSON boolean
                  </p>
               </li>
               <li>
                  <p><code>empty-sequence()</code> for a JSON null (or for empty input)
                  </p>
               </li>
            </ul>
            <p>If the input starts with a byte order mark, this function ignores it. The byte order
               mark may have been added
               to the data stream in order to facilitate decoding of an octet stream to a character
               string, but since this function
               takes a character string as input, the byte order mark serves no useful purpose.
            </p>
            <p>The possibility of the input containing characters that are not valid in XML (for
               example, unpaired surrogates)
               arises only when such characters are expressed using JSON escape sequences. The is
               because the input to the function
               is an instance of <code>xs:string</code>, which by definition can only contain characters that are valid in XML.
            </p>
         </section>
         <section>
            <header>
               <h2>Examples</h2>
            </header>
            <p>The expression <code>parse-json('{"x":1, "y":[3,4,5]}')</code> returns <code>map{"x":1e0,"y":[3e0,4e0,5e0]}</code>.
            </p>
            <p>The expression <code>parse-json('"abcd"')</code> returns <code>"abcd"</code>.
            </p>
            <p>The expression <code>parse-json('{"x":"\\", "y":"\u0025"}')</code> returns <code>map{"x":"\","y":"%"}</code>.
            </p>
            <p>The expression <code>parse-json('{"x":"\\", "y":"\u0025"}', map{'escape':true()})</code> returns <code>map{"x":"\\","y":"%"}</code>.
            </p>
            <p>The expression <code>parse-json('{"x":"\\", "y":"\u0000"}')</code> returns <code>map{"x":"\","y":codepoints-to-string(65533)}</code>.
            </p>
            <p>The expression <code>parse-json('{"x":"\\", "y":"\u0000"}', map{'escape':true()})</code> returns <code>map{"x":"\\","y":"\u0000"}</code>.
            </p>
            <p>The expression <code>parse-json('{"x":"\\", "y":"\u0000"}', map{'fallback':function($s){'['||$s||']'}})</code> returns <code>map{"x":"\","y":"[\u0000]"}</code>.
            </p>
         </section>
         <footer>
            <h2>See Also</h2>
            <ul>
               <li><a href="https://www.w3.org/TR/xpath-functions-31/#func-parse-json">XPath 3.1 Functions and Operators</a></li>
               <li><a href="http://www.saxonica.com/html/documentation/functions/fn/parse-json.html">Saxon Function Library</a></li>
            </ul>
         </footer>
      </article>
      <footer>
         <div class="container"><small class="copyright">Portions of this document were copied from <a href="https://www.w3.org/TR/2017/REC-xpath-functions-31-20170321/xpath-functions-31.xml">this file</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>&nbsp;©&nbsp;2014&nbsp;<a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved.</small></div>
      </footer>
   </body>
</html>